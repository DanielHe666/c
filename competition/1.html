<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title id="title">第 1 期 · Round 1</title>
  <meta name="theme-color" content="#0b0c0d" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    :root{ --bg:#0b0c0d; --panel:#0f1113; --muted:#9aa4ad; --text:#e6eef6; --accent:#48a0ff; --radius:12px; }
    body{margin:0;background:var(--bg);color:var(--muted);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial}
    .wrap{max-width:960px;margin:0 auto;padding:20px}
    header{display:flex;align-items:center;gap:12px;justify-content:space-between}
    header h1{color:#fff;font-size:22px;margin:0;display:flex;align-items:center;gap:8px}
    a.btn,button.btn{display:inline-flex;align-items:center;gap:8px;padding:8px 14px;border-radius:10px;text-decoration:none;border:1px solid rgba(255,255,255,0.08);background:var(--panel);color:var(--text);cursor:pointer}
    a.btn.primary,button.btn.primary{background:var(--accent);color:#071022;border:0}
    .card{background:var(--panel);border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius);padding:18px;margin-top:18px}
    .card h2{margin:0 0 12px;color:#fff;font-size:20px}
    pre{background:#161a1e;padding:12px;border-radius:10px;overflow:auto;font-size:13px;line-height:1.5}
    code{font-family:Menlo,monospace}
    table{width:100%;border-collapse:collapse;margin-top:12px;font-size:13px}
    th,td{border:1px solid #222;padding:6px 8px;text-align:left}
    th{background:#161a1e;color:#fff}
    .footer{margin-top:26px;display:flex;justify-content:space-between;align-items:center;font-size:12px}
    .notice{background:#161a1e;padding:10px;border-radius:8px;font-size:13px;line-height:1.6}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
  <h1 id="h1"><i class="fas fa-calendar-week"></i> 第 1 期 · Round 1 <span id="diffTag" style="font-size:12px;color:#9aa4ad;font-weight:400;margin-left:8px">D=120</span></h1>
      <div class="row" style="display:flex;gap:10px;flex-wrap:wrap">
        <a class="btn" href="./index.html"><i class="fas fa-list"></i> 返回列表 List</a>
  <a class="btn" href="./rank/1.html"><i class="fas fa-medal"></i> 榜单 Board</a>
  <a class="btn" href="./rank/index.html"><i class="fas fa-ranking-star"></i> 天梯榜 Ladder</a>
        <button id="langBtn" class="btn"><i class="fas fa-globe"></i> EN</button>
      </div>
    </header>

    <div class="card">
  <h2 id="problemTitle">1. 题目：打印菱形图案</h2>
      <p id="problemDesc">请编写一个 C 程序，从标准输入读取一个正奇数 n (1 <= n <= 99)，输出一个由星号组成的对称菱形图案。行末不要额外空格。输出末尾换行。示例见下。</p>
      <h3 id="inputFormatTitle">输入格式</h3>
      <p id="inputFormatDesc">输入一个正奇数 n (1 <= n <= 99)。</p>
      <h3 id="outputFormatTitle">输出格式</h3>
      <p id="outputFormatDesc">输出一个由星号组成的对称菱形，每行无尾随空格，并在末尾换行。</p>
      <h3 id="sampleIn1Title">示例输入1</h3>
      <pre style="display:none"><code id="sampleIn1">7</code></pre>
      <h3 id="sampleOut1Title">示例输出1</h3>
      <pre style="display:none"><code id="sampleOut1">   *
  ***
 *****
*******
 *****
  ***
   *</code></pre>
      <h3 id="sampleIn2Title">示例输入2</h3>
      <pre style="display:none"><code id="sampleIn2">5</code></pre>
      <h3 id="sampleOut2Title">示例输出2</h3>
      <pre style="display:none"><code id="sampleOut2">  *
 ***
*****
 ***
  *</code></pre>
    </div>

    <div class="card" id="submitCard">
      <h2><i class="fas fa-paper-plane"></i> 直接在此提交 · Submit Here</h2>
      <div class="muted" id="submitTips">在下方粘贴你的 C 代码，填写昵称（仅首次），点击“评测并提交”。评测通过才会提交到排行榜。</div>
      <div class="row" style="margin:10px 0;gap:10px;align-items:center">
        <label for="handleInput">昵称 Handle</label>
        <input id="handleInput" type="text" placeholder="你的昵称（可含空格，不可含/\\）" style="flex:1;min-width:220px"/>
        <button id="saveHandleBtn" class="btn"><i class="fas fa-user-check"></i> 保存昵称</button>
      </div>
      <textarea id="codeInput" placeholder="在此粘贴你的 C 代码..." style="width:100%;min-height:240px;background:#161a1e;border:1px solid #222;border-radius:8px;color:#e6eef6;padding:10px 12px;font-family:Menlo,monospace;font-size:13px"></textarea>
  <div class="row" style="margin-top:8px;gap:10px;flex-wrap:wrap">
    <button id="judgeBtn" class="btn primary"><i class="fas fa-vial"></i> 评测代码</button>
    <button id="genPayloadBtn" class="btn" style="display:none;background:#2ea043;border:0;color:#071022"><i class="fas fa-shield-halved"></i> 生成密文</button>
  <a class="btn" href="./rank/1.html" target="_blank" rel="noreferrer"><i class="fas fa-medal"></i> 查看第1期排行榜</a>
    <a id="submitPageBtn" class="btn" href="./submit.html" target="_blank" rel="noreferrer" style="display:none"><i class="fas fa-share-from-square"></i> 提交页（粘贴密文）</a>
  </div>
      <div id="submitStatus" class="muted" style="margin-top:8px"></div>
    </div>

    <div class="card">
  <h2 id="rulesTitle">提交 & 排名/积分规则</h2>
      <ul id="rulesList" style="line-height:1.7;margin:0 0 10px;padding-left:18px">
  <li>每轮按最小字节数排序；相同字节数按提交先后。</li>
  <li>天梯积分：为本轮设置难度积分 D，第一名得 D，其他选手得 round(D × 最小字节数/自身字节数)。该积分随榜单变化实时更新。</li>
        <li>仅统计单个 .c 文件，文件名不限，必须能在 Wandbox (gcc) 正常编译。</li>
        <li>禁止 UB、读写文件、使用非标准库；允许使用标准头文件。</li>
        <li>你的代码需从标准输入读取并向标准输出打印。</li>
        <li>我们将使用 UTF-8 字节长度 (cat file.c | wc -c)。</li>
      </ul>
      <div class="notice" id="submitGuide">
  提交方式（GitHub Pages 方案）：
  1. Fork 本仓库。
  2. 在 submissions/1/<你的昵称>/ 目录下添加 solution.c（仍兼容 submissions/week-1/）。
        3. 发起 Pull Request。
        4. 合并后 CI 自动更新排行榜 JSON。页面会定时或手动刷新加载最新数据。
        5. 不要修改他人目录；每人只保留一个最新版本（覆盖旧版本即可）。
      </div>
    </div>

    <div class="card">
      <h2 id="localTestTitle">本地快速测试</h2>
      <p id="localTestDesc"><a class="btn primary" href="../index.html" target="_blank" rel="noreferrer noopener"><i class="fas fa-code"></i> 打开编辑器（新标签页）</a></p>
    </div>

    <div class="card">
  <h2 id="apiTitle">数据/榜单获取</h2>
  <p id="apiDesc">页面将从 <code>competition/data/week-1.json</code> 获取本轮榜单数据 (静态 JSON)。字段：handle, bytes, points, commitTime, sha；以及顶层 difficulty、minBytes。</p>
      <table>
        <thead><tr><th>字段 Field</th><th>说明 Description</th></tr></thead>
        <tbody id="apiTableBody">
          <tr><td>handle</td><td>参赛者昵称 / participant handle</td></tr>
          <tr><td>bytes</td><td>代码字节数 / code byte length</td></tr>
          <tr><td>commitTime</td><td>提交时间 ISO / submission time ISO</td></tr>
          <tr><td>sha</td><td>最后一次提交 SHA / last commit SHA</td></tr>
        </tbody>
      </table>
    </div>

    <div class="footer">
      <div>By C. He · Online C Compiler</div>
      <a class="btn" href="../about.html"><i class="fas fa-circle-info"></i> 关于 About</a>
    </div>
  </div>
  <script src="../scripts/version.js"></script>
  <script src="../scripts/contest_submit.js"></script>
  <script>
    const i18n={
      zh:{ title:'第 1 期 · Round 1', header:'第 1 期 · Round 1', back:'返回列表 List', rank:'榜单 Board', total:'天梯榜 Ladder',
  problemTitle:'1. 题目：打印菱形图案', problemDesc:'请编写一个 C 程序，从标准输入读取一个正奇数 n (1 <= n <= 99)，输出一个由星号组成的对称菱形图案。行末不要额外空格。输出末尾换行。示例见下。',
        input_format_title:'输入格式', input_format_desc:'输入一个正奇数 n (1 <= n <= 99)。',
        output_format_title:'输出格式', output_format_desc:'输出一个由星号组成的对称菱形，每行无尾随空格，并在末尾换行。',
        sample_toggle_expand:'展开', sample_toggle_collapse:'收起',
        sample_in1:'示例输入1', sample_out1:'示例输出1', sample_in2:'示例输入2', sample_out2:'示例输出2',
  rulesTitle:'提交 & 排名/积分规则', rulesList:[ '每轮按最小字节数排序；相同字节数按提交先后。','天梯积分：本轮难度积分 D；第一名得 D，其余得 round(D × 最小字节数/自身字节数)，随榜单变化实时更新。','仅统计单个 .c 文件，文件名不限，必须能在 Wandbox (gcc) 正常编译。','禁止 UB、读写文件、使用非标准库；允许使用标准头文件。','你的代码需从标准输入读取并向标准输出打印。','我们将使用 UTF-8 字节长度 (cat file.c | wc -c)。' ],
  submitGuide:'提交方式（GitHub Pages 方案）：\n1. Fork 本仓库。\n2. 在 submissions/1/<你的昵称>/ 目录下添加 solution.c（仍兼容 submissions/week-1/）。\n3. 发起 Pull Request。\n4. 合并后 CI 自动更新排行榜 JSON。页面会定时或手动刷新加载最新数据。\n5. 不要修改他人目录；每人只保留一个最新版本（覆盖旧版本即可）。',
  localTestTitle:'本地快速测试', localTestDesc:'<a class="btn primary" href="../index.html" target="_blank" rel="noreferrer noopener"><i class="fas fa-code"></i> 打开编辑器（新标签页）</a>',
        apiTitle:'数据/榜单获取', apiDesc:'页面将从 competition/data/week-1.json 获取本轮榜单 (静态 JSON)。字段：handle, bytes, points, commitTime, sha；顶层含 difficulty、minBytes。'
      },
      en:{ title:'Round 1 · 第 1 期', header:'Round 1 · 第 1 期', back:'List 返回列表', rank:'Board 榜单', total:'Ladder 天梯榜',
        problemTitle:'Problem: Print Diamond Pattern', problemDesc:'Write a C program reading a positive odd n (1 <= n <= 99) from stdin. Output a symmetric diamond of asterisks. No trailing spaces per line. End with a newline.',
        input_format_title:'Input Format', input_format_desc:'A positive odd integer n (1 <= n <= 99).',
        output_format_title:'Output Format', output_format_desc:'A symmetric diamond made of asterisks, no trailing spaces per line, end with a newline.',
        sample_toggle_expand:'Expand', sample_toggle_collapse:'Collapse',
        sample_in1:'Sample Input 1', sample_out1:'Sample Output 1', sample_in2:'Sample Input 2', sample_out2:'Sample Output 2',
  rulesTitle:'Submission & Scoring Rules', rulesList:[ 'Per-round ranking by smallest bytes; ties by earlier time.','Ladder scoring: round difficulty D; 1st gets D, others round(D × minBytes/bytes). Updates dynamically as the board changes.','Only one .c file counted; any filename; must compile on Wandbox (gcc).','No UB, file I/O, or non-standard libs; standard headers allowed.','Your code must read from stdin and write to stdout.','We use UTF-8 byte length (cat file.c | wc -c).' ],
        submitGuide:'Submission (GitHub Pages flow):\n1. Fork this repo.\n2. Add solution.c under submissions/week-1/<handle>/.\n3. Open a Pull Request.\n4. After merge CI updates leaderboard JSON. Page periodically or manually reloads.\n5. Don\'t touch others\' dirs; keep only one latest version (overwrite).',
  localTestTitle:'Quick Local Test', localTestDesc:'<a class="btn primary" href="../index.html" target="_blank" rel="noreferrer noopener"><i class="fas fa-code"></i> Open Editor (new tab)</a>',
        apiTitle:'Data / Board', apiDesc:'Page fetches competition/data/week-1.json (static). Fields: handle, bytes, points, commitTime, sha; top-level includes difficulty, minBytes.'
      }
    };
    function getLang(){ try{return localStorage.getItem('ui_lang')||'zh';}catch(e){return 'zh';} }
    function setLang(l){ try{localStorage.setItem('ui_lang',l);}catch(e){} applyLang(); }
    function t(k){ const L=getLang(); return (i18n[L]&&i18n[L][k])||i18n.zh[k]||k; }
    function applyLang(){
      document.getElementById('title').textContent=t('title');
      document.getElementById('h1').innerHTML='<i class="fas fa-calendar-week"></i> '+t('header');
      const btns=document.querySelectorAll('header .row a.btn');
      btns[0].innerHTML='<i class="fas fa-list"></i> '+t('back');
      btns[1].innerHTML='<i class="fas fa-medal"></i> '+t('rank');
      btns[2].innerHTML='<i class="fas fa-ranking-star"></i> '+t('total');
  document.getElementById('problemTitle').textContent=t('problemTitle');
  document.getElementById('problemDesc').textContent=t('problemDesc');
  document.getElementById('inputFormatTitle').textContent=t('input_format_title');
  document.getElementById('inputFormatDesc').textContent=t('input_format_desc');
  document.getElementById('outputFormatTitle').textContent=t('output_format_title');
  document.getElementById('outputFormatDesc').textContent=t('output_format_desc');
  document.getElementById('sampleIn1Title').textContent=t('sample_in1');
  document.getElementById('sampleOut1Title').textContent=t('sample_out1');
  document.getElementById('sampleIn2Title').textContent=t('sample_in2');
  document.getElementById('sampleOut2Title').textContent=t('sample_out2');
      document.getElementById('rulesTitle').textContent=t('rulesTitle');
      const rl=document.getElementById('rulesList'); rl.innerHTML=''; t('rulesList').forEach(li=>{ const el=document.createElement('li'); el.textContent=li; rl.appendChild(el); });
      document.getElementById('submitGuide').textContent=t('submitGuide');
      document.getElementById('localTestTitle').textContent=t('localTestTitle');
  document.getElementById('localTestDesc').innerHTML=t('localTestDesc');
      document.getElementById('apiTitle').textContent=t('apiTitle');
      document.getElementById('apiDesc').textContent=t('apiDesc');
      document.getElementById('langBtn').innerHTML='<i class="fas fa-globe"></i> '+(getLang()==='zh'?'EN':'中');
    }
    // —— 样例折叠 ——
    function setupSampleToggles(){
      const pairs=[
        {title:'sampleIn1Title', pre:'sampleIn1'},
        {title:'sampleOut1Title', pre:'sampleOut1'},
        {title:'sampleIn2Title', pre:'sampleIn2'},
        {title:'sampleOut2Title', pre:'sampleOut2'},
      ];
      pairs.forEach(({title,pre})=>{
        const h=document.getElementById(title); const code=document.getElementById(pre);
        if(!h||!code) return;
        // ensure wrapper <pre> is the parent of code
        const preEl=code.parentElement;
        if(!h.querySelector('.toggle')){
          const btn=document.createElement('button');
          btn.className='btn ghost toggle';
          btn.style.marginLeft='8px'; btn.style.padding='4px 8px'; btn.style.fontSize='12px';
          const setLabel=()=>{ btn.textContent = (preEl.style.display==='none'||getComputedStyle(preEl).display==='none')? t('sample_toggle_expand') : t('sample_toggle_collapse'); };
          setLabel();
          btn.addEventListener('click',()=>{
            const hidden = (preEl.style.display==='none'||getComputedStyle(preEl).display==='none');
            preEl.style.display = hidden? 'block':'none';
            setLabel();
          });
          h.appendChild(btn);
        }
      });
    }
    function updateToggleLabels(){
      document.querySelectorAll('.toggle').forEach(btn=>{
        const preEl = btn.closest('h3')?.nextElementSibling;
        if(!preEl) return;
        btn.textContent = (preEl.style.display==='none'||getComputedStyle(preEl).display==='none')? t('sample_toggle_expand') : t('sample_toggle_collapse');
      });
    }
    document.getElementById('langBtn').addEventListener('click',()=>{ setLang(getLang()==='zh'?'en':'zh'); updateToggleLabels(); });
    applyLang();
    setupSampleToggles();

    // —— 提交区域逻辑 ——
    (function(){
      const handleInput = document.getElementById('handleInput');
      const saveHandleBtn = document.getElementById('saveHandleBtn');
      const codeInput = document.getElementById('codeInput');
  const judgeBtn = document.getElementById('judgeBtn');
  const genBtn = document.getElementById('genPayloadBtn');
  const submitPageBtn = document.getElementById('submitPageBtn');
      const statusEl = document.getElementById('submitStatus');
      // 预填 handle
      try{ const h = window.__ContestSubmit.getHandle(); if(h) handleInput.value = h; }catch(e){}
      saveHandleBtn.addEventListener('click', ()=>{
        const raw = (handleInput.value||'').trim();
        if(!raw){ alert('昵称不能为空'); return; }
        window.__ContestSubmit.setProfile({ handle: raw });
        saveHandleBtn.innerHTML = '<i class="fas fa-check"></i> 已保存';
        setTimeout(()=>{ saveHandleBtn.innerHTML = '<i class="fas fa-user-check"></i> 保存昵称'; }, 1200);
      });

      function genDiamond(n){ const lines=[]; const mid=(n-1)/2; for(let r=0;r<n;r++){ const dist=Math.abs(mid-r); const stars=n-2*dist; const spaces=dist; lines.push(' '.repeat(spaces)+('*'.repeat(stars))); } return lines.join('\n'); }
      async function tryWandbox(code, stdin){
        const wandboxUrl='https://wandbox.org/api/compile.json';
        const payload={ code, compiler:'gcc-head', stdin: stdin||undefined, save:false };
        const res = await fetch(wandboxUrl,{method:'POST', headers:{'content-type':'application/json'}, body: JSON.stringify(payload)});
        if(!res.ok) throw new Error('wandbox '+res.status);
        const j=await res.json();
        const out=(j.program_output||j.program_stdout||j.program||j.result||'')||'';
        return out.replace(/\n+$/,'');
      }
      async function judgeWeek1(source){
        let tests=[];
        try{ const r=await fetch('./data/tests/week-1.json',{cache:'no-store'}); if(r.ok) tests = await r.json(); }catch(_){ }
        if(!Array.isArray(tests)||!tests.length){ tests=[1,3,5].map(n=>({stdin:String(n)+'\n', expected: genDiamond(n)})); }
        for(const tc of tests){
          const out = await tryWandbox(source, tc.stdin);
          const exp = (tc.expect||tc.expected||'').replace(/\n+$/,'');
          if(out!==exp) return false;
        }
        return true;
      }

      judgeBtn.addEventListener('click', async ()=>{
        const handleRaw = (handleInput.value||'').trim();
        if(!handleRaw){ alert('请先填写昵称'); return; }
        window.__ContestSubmit.setProfile({ handle: handleRaw });
        const source = codeInput.value||'';
        if(!source.trim()){ alert('请粘贴代码'); return; }
        statusEl.style.color=''; statusEl.textContent='评测中 / Judging...';
        genBtn.style.display='none';
        try{
          const pass = await judgeWeek1(source);
          if(!pass){ statusEl.style.color='#ff6b6b'; statusEl.textContent='WA：输出不匹配，未通过。'; return; }
          statusEl.style.color='#56d364'; statusEl.textContent='通过 | Accepted。现在可生成密文并打开提交页。';
          genBtn.style.display='inline-flex';
          submitPageBtn.style.display='inline-flex';
          genBtn.focus();
        }catch(e){ statusEl.style.color='#ffb020'; statusEl.textContent='评测失败（网络/服务异常），请稍后再试。'; }
      });

      genBtn.addEventListener('click', async ()=>{
        const source = codeInput.value||'';
        if(!source.trim()){ alert('代码为空'); return; }
        genBtn.disabled=true; const old=genBtn.innerHTML; genBtn.innerHTML='<i class="fas fa-spinner fa-spin"></i> 生成中';
        statusEl.style.color=''; statusEl.textContent='生成密文中...';
        try{
          const payload = await window.__ContestSubmit.buildPayload('1', source);
          const slim = payload.version===3 ? { type:'contest', version:3, challenge: payload.challenge, enc: payload.enc, encCode: payload.encCode, key: payload.key } : payload;
          const jsonStr = JSON.stringify(slim, null, 2);
          // 记住最近一次生成的密文，供“提交页”按钮点击时兜底复制
          try{ window.__LAST_SUBMISSION_JSON = jsonStr; }catch(_){ }
          const b64 = btoa(unescape(encodeURIComponent(JSON.stringify(payload))));
          const url = './submit.html#submission='+b64;
          // 尝试自动复制到剪贴板
          let copied = false;
          try{
            await navigator.clipboard.writeText(jsonStr);
            copied = true;
          }catch(_){ copied = false; }
          const copiedTip = copied ? '（已自动复制到剪贴板）' : '（复制失败，请手动复制下方 JSON）';
          statusEl.innerHTML='✅ 已生成密文 '+copiedTip+'。<br>1) 打开提交页。<br>2) 在 Fork 里新建/覆盖 solution.c 粘贴下列 JSON：<br><pre style="background:#161a1e;padding:10px;border-radius:8px;overflow:auto;font-size:12px"><code>'+jsonStr.replace(/[&<>]/g,s=>({"&":"&amp;","<":"&lt;",">":"&gt;"}[s]))+'</code></pre>';
          const a=document.createElement('a'); a.href=url; a.target='_blank'; a.rel='noreferrer'; a.textContent='打开提交页（新标签）'; a.className='btn'; a.style.marginTop='8px'; statusEl.appendChild(a);
          // 同时给“提交页（粘贴密文）”按钮绑定点击复制兜底
          submitPageBtn.onclick = async ()=>{
            if(window.__LAST_SUBMISSION_JSON){ try{ await navigator.clipboard.writeText(window.__LAST_SUBMISSION_JSON); }catch(_){ /* ignore */ } }
          };
        }catch(e){ statusEl.style.color='#ff6b6b'; statusEl.textContent='生成密文失败：'+(e&&e.message||e); }
        finally{ genBtn.disabled=false; genBtn.innerHTML=old; }
      });
    })();
  </script>
</body>
</html>

<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title id="title">C Code Golf · 挑战轮次</title>
  <meta name="theme-color" content="#0b0c0d" />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css" />
  <style>
    :root{ --bg:#0b0c0d; --panel:#0f1113; --muted:#9aa4ad; --text:#e6eef6; --accent:#48a0ff; --radius:12px; }
    body{margin:0;background:var(--bg);color:var(--muted);font-family:-apple-system,BlinkMacSystemFont,"Segoe UI",Roboto,Arial}
    .wrap{max-width:1040px;margin:0 auto;padding:20px}
    header{display:flex;align-items:center;gap:10px;justify-content:space-between}
    header h1{color:#fff;font-size:22px;margin:0;display:flex;align-items:center;gap:8px}
    .grid{display:grid;grid-template-columns:repeat(3,minmax(0,1fr));gap:16px;margin-top:16px}
    .card{background:var(--panel);border:1px solid rgba(255,255,255,0.08);border-radius:var(--radius);padding:16px}
    .card h3{margin:0 0 8px;color:#fff}
    .card p{margin:0 0 10px;line-height:1.7}
    .row{display:flex;gap:10px;flex-wrap:wrap}
    a.btn{display:inline-flex;align-items:center;gap:8px;padding:8px 12px;border-radius:10px;text-decoration:none;border:1px solid rgba(255,255,255,0.08);color:var(--text)}
    a.btn.primary{background:var(--accent);color:#071022;border:0}
    .footer{margin-top:22px;display:flex;justify-content:space-between;align-items:center}
    .light body{--bg:#f3f6fb;--panel:#fff;--muted:#4b5563;--text:#0b1220;--accent:#2563eb}
  </style>
</head>
<body>
  <div class="wrap">
    <header>
  <h1 id="h1"><i class="fas fa-flag-checkered"></i> C Code Golf 挑战轮次</h1>
      <div class="row">
        <a class="btn" href="../index.html"><i class="fas fa-code"></i> 编辑器 Editor</a>
  <a class="btn" href="./rank/index.html"><i class="fas fa-ranking-star"></i> 天梯榜 Ladder</a>
        <a class="btn" href="../submission_guide/problem-authoring.html" target="_blank" rel="noreferrer"><i class="fas fa-feather"></i> 投稿 Author</a>
        <button id="langBtn" class="btn"><i class="fas fa-globe"></i> EN</button>
      </div>
    </header>

    <div class="card">
      <h3 id="introTitle">活动说明</h3>
	<p id="introDesc">若干轮（Round）C 语言高尔夫题：按字节数排名。天梯积分：每轮难度积分 D；第一名得 D，其他得 round(D × 最小字节数/自身字节数)，随提交实时变化。</p>
      <div class="row">
	<a id="firstProblemBtn" class="btn primary" href="#"><i class="fas fa-calendar-week"></i> …</a>
	<a id="firstRankBtn" class="btn" href="#"><i class="fas fa-trophy"></i> …</a>
      </div>
    </div>

    <div class="grid" id="weeks"></div>

    <div class="footer">
      <div>By C. He from ZJU · Online C Compiler</div>
      <a class="btn" href="../about.html"><i class="fas fa-circle-info"></i> 关于 About</a>
    </div>
  </div>
  <script>
    const i18n={
      zh:{ title:'C Code Golf · 挑战轮次', header:'C Code Golf 挑战轮次', editor:'编辑器 Editor', total:'天梯榜 Ladder',
        introTitle:'活动说明', introDesc:'若干轮（Round）C 语言高尔夫题：按字节数排名。天梯积分：每轮难度积分 D；第一名得 D，其他得 round(D × 最小字节数/自身字节数)，随提交实时变化。',
        week1:'打印指定图案（示例题）。', problem:'题目 Problem', rank:'榜单 Board'
      },
      en:{ title:'C Code Golf · Rounds', header:'C Code Golf Rounds', editor:'Editor 编辑器', total:'Ladder 天梯榜',
        introTitle:'Overview', introDesc:'Multiple C code golf rounds ranked by byte size. Ladder scoring: round difficulty D; 1st gets D, others round(D × minBytes/bytes); updates in real time.',
        week1:'Print the specified pattern (sample).', problem:'Problem 题目', rank:'Board 榜单'
      }
    };
    function getLang(){ try{return localStorage.getItem('ui_lang')||'zh';}catch(e){return 'zh';} }
  function setLang(l){ try{localStorage.setItem('ui_lang',l);}catch(e){} applyLang(); renderProblems(); }
    function t(k){ const L=getLang(); return (i18n[L]&&i18n[L][k])||i18n.zh[k]||k; }
    function applyLang(){
      document.getElementById('title').textContent=t('title');
      document.getElementById('h1').innerHTML='<i class="fas fa-flag-checkered"></i> '+t('header');
      const rows=document.querySelectorAll('a.btn');
      // 前两个固定按钮
      if(rows[0]) rows[0].innerHTML='<i class="fas fa-code"></i> '+t('editor');
  if(rows[1]) rows[1].innerHTML='<i class="fas fa-ranking-star"></i> '+t('total');
  // 第三个按钮是投稿指南，保持双语并行显示
      document.getElementById('introTitle').textContent=t('introTitle');
      document.getElementById('introDesc').textContent=t('introDesc');
      const langBtn=document.getElementById('langBtn'); langBtn.innerHTML='<i class="fas fa-globe"></i> '+(getLang()==='zh'?'EN':'中');
    }
    document.getElementById('langBtn').addEventListener('click',()=>setLang(getLang()==='zh'?'en':'zh'));
    applyLang();

    async function renderProblems(){
      const container = document.getElementById('weeks');
      if(!container) return;
      container.innerHTML='';
      let list=[];
      try{
        const res=await fetch('./problems.json?fresh='+(Date.now()),{cache:'no-store'});
        if(res.ok) list=await res.json();
      }catch(e){}
      if(!Array.isArray(list)||list.length===0){
        list=[{id:1,name_zh:'打印指定图案',name_en:'Print Specified Pattern',difficulty:120,desc:t('week1')}];
      }
      const L=getLang();
      const first=list[0];
      const fp=document.getElementById('firstProblemBtn');
      const fr=document.getElementById('firstRankBtn');
      const firstName=L==='zh'?(first.name_zh||first.name_en||('Round '+first.id)):(first.name_en||first.name_zh||('Round '+first.id));
      if(fp){ fp.href=`./${first.id}.html`; fp.innerHTML=`<i class="fas fa-calendar-week"></i> ${first.id}. ${firstName}`; }
  if(fr){ fr.href=`./rank/week.html?week=${first.id}`; fr.innerHTML=`<i class="fas fa-trophy"></i> ${L==='zh'?('第 '+first.id+' 期榜单'):('Round '+first.id+' Board')}`; }
      list.forEach(p=>{
        const name=L==='zh'?(p.name_zh||p.name_en||('Round '+p.id)):(p.name_en||p.name_zh||('Round '+p.id));
        const d=(typeof p.difficulty==='number')?p.difficulty: (typeof p.points==='number'?p.points:undefined);
        const badge=d!=null?`<span style="font-weight:400;color:#9aa4ad;font-size:12px">D=${d}</span>`:'';
        const card=document.createElement('div'); card.className='card';
        card.innerHTML=`<h3>${p.id}. ${name} ${badge}</h3>
          <p>${p.desc||''}</p>
          <div class='row'>
            <a class='btn' href='./${p.id}.html'><i class='fas fa-book-open'></i> ${t('problem')}</a>
            <a class='btn' href='./rank/week.html?week=${p.id}'><i class='fas fa-medal'></i> ${t('rank')}</a>
          </div>`;
        container.appendChild(card);
      });
    }
    renderProblems();
  </script>
</body>
</html>
